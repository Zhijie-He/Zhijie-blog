<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基础教程 | Zhijie He&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Zhijie He&#39;s learning blogs in computer science">
    
    <link rel="preload" href="/learning-blogs/assets/css/0.styles.f8b47888.css" as="style"><link rel="preload" href="/learning-blogs/assets/js/app.023149a4.js" as="script"><link rel="preload" href="/learning-blogs/assets/js/2.4cc10ed0.js" as="script"><link rel="preload" href="/learning-blogs/assets/js/1.91ea3048.js" as="script"><link rel="preload" href="/learning-blogs/assets/js/11.a25d570d.js" as="script"><link rel="prefetch" href="/learning-blogs/assets/js/10.4d0079fb.js"><link rel="prefetch" href="/learning-blogs/assets/js/12.d87c0ace.js"><link rel="prefetch" href="/learning-blogs/assets/js/13.1a43b501.js"><link rel="prefetch" href="/learning-blogs/assets/js/14.6a978a6e.js"><link rel="prefetch" href="/learning-blogs/assets/js/15.81b6c8b5.js"><link rel="prefetch" href="/learning-blogs/assets/js/16.3637d4f7.js"><link rel="prefetch" href="/learning-blogs/assets/js/17.62ca55f1.js"><link rel="prefetch" href="/learning-blogs/assets/js/18.c36d9be8.js"><link rel="prefetch" href="/learning-blogs/assets/js/19.d6620149.js"><link rel="prefetch" href="/learning-blogs/assets/js/20.a728a170.js"><link rel="prefetch" href="/learning-blogs/assets/js/21.2f0a0271.js"><link rel="prefetch" href="/learning-blogs/assets/js/22.6180816b.js"><link rel="prefetch" href="/learning-blogs/assets/js/23.878596c4.js"><link rel="prefetch" href="/learning-blogs/assets/js/24.8056bf81.js"><link rel="prefetch" href="/learning-blogs/assets/js/25.0b213a97.js"><link rel="prefetch" href="/learning-blogs/assets/js/26.5e1034dc.js"><link rel="prefetch" href="/learning-blogs/assets/js/27.91e51ec8.js"><link rel="prefetch" href="/learning-blogs/assets/js/28.065d51b5.js"><link rel="prefetch" href="/learning-blogs/assets/js/29.6e23176b.js"><link rel="prefetch" href="/learning-blogs/assets/js/3.bd89fe37.js"><link rel="prefetch" href="/learning-blogs/assets/js/30.fc97d9e8.js"><link rel="prefetch" href="/learning-blogs/assets/js/31.a4fef5bd.js"><link rel="prefetch" href="/learning-blogs/assets/js/32.304378ad.js"><link rel="prefetch" href="/learning-blogs/assets/js/33.5b418366.js"><link rel="prefetch" href="/learning-blogs/assets/js/34.8c1d4ab1.js"><link rel="prefetch" href="/learning-blogs/assets/js/35.7309b6e5.js"><link rel="prefetch" href="/learning-blogs/assets/js/36.e9ce87c9.js"><link rel="prefetch" href="/learning-blogs/assets/js/37.f17d44cc.js"><link rel="prefetch" href="/learning-blogs/assets/js/38.82558ec4.js"><link rel="prefetch" href="/learning-blogs/assets/js/39.bfee11e0.js"><link rel="prefetch" href="/learning-blogs/assets/js/4.7b60af58.js"><link rel="prefetch" href="/learning-blogs/assets/js/40.c9c50cde.js"><link rel="prefetch" href="/learning-blogs/assets/js/41.b2a2cca9.js"><link rel="prefetch" href="/learning-blogs/assets/js/42.102500cb.js"><link rel="prefetch" href="/learning-blogs/assets/js/43.be7ac4cf.js"><link rel="prefetch" href="/learning-blogs/assets/js/44.9fe9b32a.js"><link rel="prefetch" href="/learning-blogs/assets/js/45.bea8e4aa.js"><link rel="prefetch" href="/learning-blogs/assets/js/46.ec621935.js"><link rel="prefetch" href="/learning-blogs/assets/js/47.b7fae7bb.js"><link rel="prefetch" href="/learning-blogs/assets/js/48.fdc47c13.js"><link rel="prefetch" href="/learning-blogs/assets/js/49.c8489b22.js"><link rel="prefetch" href="/learning-blogs/assets/js/5.8c2caae0.js"><link rel="prefetch" href="/learning-blogs/assets/js/50.ee71df54.js"><link rel="prefetch" href="/learning-blogs/assets/js/51.c82918e2.js"><link rel="prefetch" href="/learning-blogs/assets/js/52.5370e504.js"><link rel="prefetch" href="/learning-blogs/assets/js/53.31e86553.js"><link rel="prefetch" href="/learning-blogs/assets/js/54.063a693e.js"><link rel="prefetch" href="/learning-blogs/assets/js/55.12da9be3.js"><link rel="prefetch" href="/learning-blogs/assets/js/56.ab455507.js"><link rel="prefetch" href="/learning-blogs/assets/js/6.af045fac.js"><link rel="prefetch" href="/learning-blogs/assets/js/7.f22cdc7f.js"><link rel="prefetch" href="/learning-blogs/assets/js/vendors~docsearch.11055bee.js">
    <link rel="stylesheet" href="/learning-blogs/assets/css/0.styles.f8b47888.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learning-blogs/" class="home-link router-link-active"><!----> <span class="site-name">Zhijie He's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Zhijie-He/learning-blogs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Zhijie-He/learning-blogs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/learning-blogs/" class="sidebar-heading clickable router-link-active"><span>欢迎学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learning-blogs/" aria-current="page" class="sidebar-link">学前必读</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-blogs/vuepress" class="sidebar-heading clickable"><span>VuePress</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/learning-blogs/markdown/" class="sidebar-link">Markdown 教程</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-blogs/miniprograms" class="sidebar-heading clickable"><span>微信小程序</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-blogs/phd" class="sidebar-heading clickable"><span>博士</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-blogs/coding-tips" class="sidebar-heading clickable"><span>编程技巧</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-blogs/pytorch" class="sidebar-heading clickable"><span>PyTorch</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-blogs/pytorch-timm" class="sidebar-heading clickable router-link-active open"><span>PyTorch Timm</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learning-blogs/pytorch-timm/" aria-current="page" class="sidebar-link">PyTorch Timm 安装</a></li><li><a href="/learning-blogs/pytorch-timm/basics.html" aria-current="page" class="active sidebar-link">基础教程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learning-blogs/pytorch-timm/basics.html#models" class="sidebar-link">Models</a></li><li class="sidebar-sub-header"><a href="/learning-blogs/pytorch-timm/basics.html#特征提取" class="sidebar-link">特征提取</a></li><li class="sidebar-sub-header"><a href="/learning-blogs/pytorch-timm/basics.html#导出多种格式文件" class="sidebar-link">导出多种格式文件</a></li><li class="sidebar-sub-header"><a href="/learning-blogs/pytorch-timm/basics.html#data-augmentation" class="sidebar-link">Data Augmentation</a></li><li class="sidebar-sub-header"><a href="/learning-blogs/pytorch-timm/basics.html#datasets" class="sidebar-link">Datasets</a></li><li class="sidebar-sub-header"><a href="/learning-blogs/pytorch-timm/basics.html#optimizers" class="sidebar-link">Optimizers</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-blogs/pytorch-lightning" class="sidebar-heading clickable"><span>PyTorch Lightning</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-blogs/UvA-DL-notebooks" class="sidebar-heading clickable"><span>深度学习教程</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基础教程"><a href="#基础教程" class="header-anchor">#</a> 基础教程</h1> <p>这个教程主要依据</p> <p><a href="https://towardsdatascience.com/getting-started-with-pytorch-image-models-timm-a-practitioners-guide-4e77b4bf9055" target="_blank" rel="noopener noreferrer">Getting Started with PyTorch Image Models (timm): A Practitioner’s Guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="models"><a href="#models" class="header-anchor">#</a> Models</h2> <p>下载完<code>timm</code>后</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> timm

<span class="token keyword">print</span><span class="token punctuation">(</span>timm<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token number">0.9</span><span class="token number">.16</span>
</code></pre></div><p>目前使用的版本是0.9.16</p> <p>同时可以展示目前<code>timm</code>上有多少可用的模型：</p> <div class="language- extra-class"><pre class="language-text"><code># We can list, and query, the collection available models as demonstrated below:
print(f'available models: {len(timm.list_models('*'))}')
# We can also use the pretrained argument to filter this selection to the models with pretrained weights:
print(f'models with pretrained weights: {len(timm.list_models(pretrained=True))}')

available models: 1032
models with pretrained weights: 1329
</code></pre></div><p>这里models with pretrained weights的数量大于available models的数量是因为模型的权重有多种来源。</p> <p>这里使用比较熟悉的ResNet模型：</p> <div class="language-python extra-class"><pre class="language-python"><code>resnet_family <span class="token operator">=</span> timm<span class="token punctuation">.</span>list_models<span class="token punctuation">(</span><span class="token string">'resnet*'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>resnet_family<span class="token punctuation">)</span><span class="token punctuation">)</span>
vgg_family <span class="token operator">=</span> timm<span class="token punctuation">.</span>list_models<span class="token punctuation">(</span><span class="token string">'vgg*'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>vgg_family<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>vgg_family<span class="token punctuation">)</span>

<span class="token number">60</span>
<span class="token number">8</span>
<span class="token punctuation">[</span><span class="token string">'vgg11'</span><span class="token punctuation">,</span> <span class="token string">'vgg11_bn'</span><span class="token punctuation">,</span> <span class="token string">'vgg13'</span><span class="token punctuation">,</span> <span class="token string">'vgg13_bn'</span><span class="token punctuation">,</span> <span class="token string">'vgg16'</span><span class="token punctuation">,</span> <span class="token string">'vgg16_bn'</span><span class="token punctuation">,</span> <span class="token string">'vgg19'</span><span class="token punctuation">,</span> <span class="token string">'vgg19_bn'</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="创建模型"><a href="#创建模型" class="header-anchor">#</a> 创建模型</h3> <blockquote><p>Let’s demonstrate this by creating a Resnet-D model, as introduced in the <a href="https://arxiv.org/abs/1812.01187" target="_blank" rel="noopener noreferrer">Bag of Tricks for Image Classification For Convolutional Neural Networks paper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>; which is a modification on the ResNet architecture that utilises an average pooling tweak for down-sampling.</p></blockquote> <p>这里使用Resnet-D模型</p> <div class="language-python extra-class"><pre class="language-python"><code>model <span class="token operator">=</span> timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">'resnet50d'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span>

ResNet<span class="token punctuation">(</span>
  <span class="token punctuation">(</span>conv1<span class="token punctuation">)</span><span class="token punctuation">:</span> Sequential<span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> BatchNorm2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-05</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> track_running_stats<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span> BatchNorm2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-05</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> track_running_stats<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">(</span>bn1<span class="token punctuation">)</span><span class="token punctuation">:</span> BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-05</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> track_running_stats<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span>act1<span class="token punctuation">)</span><span class="token punctuation">:</span> ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span>maxpool<span class="token punctuation">)</span><span class="token punctuation">:</span> MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> dilation<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> ceil_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span>layer1<span class="token punctuation">)</span><span class="token punctuation">:</span> Sequential<span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Bottleneck<span class="token punctuation">(</span>
      <span class="token punctuation">(</span>conv1<span class="token punctuation">)</span><span class="token punctuation">:</span> Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>bn1<span class="token punctuation">)</span><span class="token punctuation">:</span> BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-05</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> track_running_stats<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>act1<span class="token punctuation">)</span><span class="token punctuation">:</span> ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>conv2<span class="token punctuation">)</span><span class="token punctuation">:</span> Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>bn2<span class="token punctuation">)</span><span class="token punctuation">:</span> BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-05</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> track_running_stats<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>drop_block<span class="token punctuation">)</span><span class="token punctuation">:</span> Identity<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>act2<span class="token punctuation">)</span><span class="token punctuation">:</span> ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>aa<span class="token punctuation">)</span><span class="token punctuation">:</span> Identity<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>conv3<span class="token punctuation">)</span><span class="token punctuation">:</span> Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>bn3<span class="token punctuation">)</span><span class="token punctuation">:</span> BatchNorm2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-05</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> track_running_stats<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">(</span>global_pool<span class="token punctuation">)</span><span class="token punctuation">:</span> SelectAdaptivePool2d<span class="token punctuation">(</span>pool_type<span class="token operator">=</span>avg<span class="token punctuation">,</span> flatten<span class="token operator">=</span>Flatten<span class="token punctuation">(</span>start_dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> end_dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span>fc<span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> 

<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'timm.models.resnet.ResNet'</span><span class="token operator">&gt;</span>
</code></pre></div><p>通过<code>pretrained_cfg</code>属性，可以获得模型的进一步信息，比如输入数据的维度，目标类的大小等等。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>pretrained_cfg<span class="token punctuation">)</span>

<span class="token punctuation">{</span><span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'https://github.com/rwightman/pytorch-image-models/releases/download/v0.1-weights/resnet50d_ra2-464e36ba.pth'</span><span class="token punctuation">,</span>
 <span class="token string">'hf_hub_id'</span><span class="token punctuation">:</span> <span class="token string">'timm/resnet50d.ra2_in1k'</span><span class="token punctuation">,</span>
 <span class="token string">'architecture'</span><span class="token punctuation">:</span> <span class="token string">'resnet50d'</span><span class="token punctuation">,</span>
 <span class="token string">'tag'</span><span class="token punctuation">:</span> <span class="token string">'ra2_in1k'</span><span class="token punctuation">,</span>
 <span class="token string">'custom_load'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
 <span class="token string">'input_size'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token string">'test_input_size'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">288</span><span class="token punctuation">,</span> <span class="token number">288</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token string">'fixed_input_size'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
 <span class="token string">'interpolation'</span><span class="token punctuation">:</span> <span class="token string">'bicubic'</span><span class="token punctuation">,</span>
 <span class="token string">'crop_pct'</span><span class="token punctuation">:</span> <span class="token number">0.875</span><span class="token punctuation">,</span>
 <span class="token string">'test_crop_pct'</span><span class="token punctuation">:</span> <span class="token number">0.95</span><span class="token punctuation">,</span>
 <span class="token string">'crop_mode'</span><span class="token punctuation">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
 <span class="token string">'mean'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">0.485</span><span class="token punctuation">,</span> <span class="token number">0.456</span><span class="token punctuation">,</span> <span class="token number">0.406</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token string">'std'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">0.229</span><span class="token punctuation">,</span> <span class="token number">0.224</span><span class="token punctuation">,</span> <span class="token number">0.225</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token string">'num_classes'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
 <span class="token string">'pool_size'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token string">'first_conv'</span><span class="token punctuation">:</span> <span class="token string">'conv1.0'</span><span class="token punctuation">,</span>
 <span class="token string">'classifier'</span><span class="token punctuation">:</span> <span class="token string">'fc'</span><span class="token punctuation">,</span>
 <span class="token string">'origin_url'</span><span class="token punctuation">:</span> <span class="token string">'https://github.com/huggingface/pytorch-image-models'</span><span class="token punctuation">}</span>
</code></pre></div><blockquote><p>One less well known, but incredibly useful, feature of timm models is that they are able to work on input images with varying numbers of channels, which pose a problem for most other libraries; an excellent explanation of how this works is described <a href="https://timm.fast.ai/models#So-how-is-timm-able-to-load-these-weights?" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Intuitively, timm does this by summing the weights of the initial convolutional layer for channels fewer than 3, or intelligently replicating these weights to the desired number of channels otherwise.</p></blockquote> <blockquote><p>We can specify the number of channels for our input images by passing the in_chans argument to create_model.</p></blockquote> <p>另一个比较有用的功能是timm模型允许我们改变输入图片的channels, 可以在创建模型的时候传入in_chans参数进行指定：</p> <div class="language-python extra-class"><pre class="language-python"><code>model <span class="token operator">=</span> timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">'resnet50d'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> in_chans<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># single channel image</span>
x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span>
model<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>shape

torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="自定义模型"><a href="#自定义模型" class="header-anchor">#</a> 自定义模型</h3> <p><code>create_model</code>函数还提供了其他的参数供我们自定义模型：</p> <ul><li>in_chans: 如上文提到的，可以修改模型对输入图片维度的要求</li> <li>global_pool: 选择在最后分类层之前使用什么类型的global pooling</li> <li>drop_rate: 为训练设置dropout rate（默认为0）</li> <li>num_classes：修改目标类数量</li></ul> <h4 id="修改目标类数量"><a href="#修改目标类数量" class="header-anchor">#</a> 修改目标类数量</h4> <p>正如我们在上文看到的ResNet-D模型架构一样，最后分类层叫做fc.</p> <p><code>(fc): Linear(in_features=2048, out_features=1000, bias=True)</code></p> <p>所以同其他库一样，可以直接通过<code>model.fc</code>去访问分类层。但是并不一定所有的模型都是这样的结构，因此timm额外提供了<code>get_classifier()</code>方法去获得最后分类层</p> <div class="language-python extra-class"><pre class="language-python"><code>model<span class="token punctuation">.</span>get_classifier<span class="token punctuation">(</span><span class="token punctuation">)</span>

Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><p>通过传入num_classes参数修改模型的目标类数量</p> <div class="language-python extra-class"><pre class="language-python"><code>NUM_FINETUNE_CLASSES <span class="token operator">=</span> <span class="token number">10</span>
model <span class="token operator">=</span> timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">'resnet50d'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_classes<span class="token operator">=</span>NUM_FINETUNE_CLASSES<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>get_classifier<span class="token punctuation">(</span><span class="token punctuation">)</span>

Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><p>但如果有时候想要去查看倒数第二层的输出结果，可以将输出类的数量设置为0，这样会创建一个identity function, 可以直接输出上一层的结果：</p> <div class="language-python extra-class"><pre class="language-python"><code>NUM_FINETUNE_CLASSES <span class="token operator">=</span> <span class="token number">0</span>
model <span class="token operator">=</span> timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">'resnet50d'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_classes<span class="token operator">=</span>NUM_FINETUNE_CLASSES<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>get_classifier<span class="token punctuation">(</span><span class="token punctuation">)</span>

Identity<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="global-pooling"><a href="#global-pooling" class="header-anchor">#</a> Global Pooling</h4> <p>同样，根据之前输出的模型结构，我们可以看到global pooling层在最后分类层前使用，我们可以通过
<code>model.global_pool</code>的方式去查看global pooling层的设置：</p> <p><code>SelectAdaptivePool2d(pool_type=avg, flatten=Flatten(start_dim=1, end_dim=-1))</code></p> <p>这里看到返回了一个SelectAdaptivePool2d的实例，其提供了不同的pooling和flattening的配置选择，目前支持的选择有：</p> <ul><li>avg : Average pooling</li> <li>max : Max pooling</li> <li>avgmax: the sum of average and max pooling, re-scaled by 0.5</li> <li>catavgmax: a concatenation of the outputs of average and max pooling along feature dimension. Note that this will double the feature dimension.</li> <li>‘’ : No pooling is used, the pooling layer is replaced by an Identity operation</li></ul> <p>我们可以展示当使用不同种类pooling时输出的结果, (这里通过设置num_classes=0来输出倒数第二层的结果)：</p> <div class="language-python extra-class"><pre class="language-python"><code>pool_types <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'avg'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">,</span> <span class="token string">'avgmax'</span><span class="token punctuation">,</span> <span class="token string">'catavgmax'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span>
NUM_FINETUNE_CLASSES <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> pool <span class="token keyword">in</span> pool_types<span class="token punctuation">:</span>
    model <span class="token operator">=</span> timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">'resnet50d'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                              num_classes<span class="token operator">=</span>NUM_FINETUNE_CLASSES<span class="token punctuation">,</span> 
                              <span class="token operator">**</span>global_pool <span class="token operator">=</span> pool<span class="token operator">**</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># create_model 默认返回的为train模式， 所以测试的时候要改为eval mode</span>
    feature_output <span class="token operator">=</span> model<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>pool<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>feature_output<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

avg<span class="token punctuation">:</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token builtin">max</span><span class="token punctuation">:</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
avgmax<span class="token punctuation">:</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
catavgmax<span class="token punctuation">:</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">:</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="修改存在的模型"><a href="#修改存在的模型" class="header-anchor">#</a> 修改存在的模型</h4> <p>我们可以使用<code>reset_classifier</code>函数同时修改分类层目标类的数量以及pooling层</p> <div class="language-python extra-class"><pre class="language-python"><code>m <span class="token operator">=</span> timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">'resnet50d'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Origianl pooling: </span><span class="token interpolation"><span class="token punctuation">{</span>m<span class="token punctuation">.</span>global_pool<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Origianl classifier: </span><span class="token interpolation"><span class="token punctuation">{</span>m<span class="token punctuation">.</span>get_classifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span>

m<span class="token punctuation">.</span>reset_classifier<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Modified pooling: </span><span class="token interpolation"><span class="token punctuation">{</span>m<span class="token punctuation">.</span>global_pool<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Modified classifier: </span><span class="token interpolation"><span class="token punctuation">{</span>m<span class="token punctuation">.</span>get_classifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

Origianl pooling<span class="token punctuation">:</span> SelectAdaptivePool2d<span class="token punctuation">(</span>pool_type<span class="token operator">=</span>avg<span class="token punctuation">,</span> flatten<span class="token operator">=</span>Flatten<span class="token punctuation">(</span>start_dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> end_dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Origianl classifier<span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Modified pooling<span class="token punctuation">:</span> SelectAdaptivePool2d<span class="token punctuation">(</span>pool_type<span class="token operator">=</span><span class="token builtin">max</span><span class="token punctuation">,</span> flatten<span class="token operator">=</span>Flatten<span class="token punctuation">(</span>start_dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> end_dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Modified classifier<span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="创建一个新的分类层"><a href="#创建一个新的分类层" class="header-anchor">#</a> 创建一个新的分类层</h4> <blockquote><p>when finetuning models on downstream tasks, I’ve often found that using a slightly larger head can lead to increased performance. Let’s explore how we can modify our ResNet model further.</p></blockquote> <blockquote><p>As we are using a larger head, let’s use catavgmax for our pooling, so that we provide more information as input to our classifier.</p></blockquote> <p>使用较大的分类层能够提高模型效果：</p> <div class="language-python extra-class"><pre class="language-python"><code>NUM_FINETUNE_CLASSES <span class="token operator">=</span> <span class="token number">10</span>
model <span class="token operator">=</span> timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">'resnet50d'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                           num_classes<span class="token operator">=</span>NUM_FINETUNE_CLASSES<span class="token punctuation">,</span> global_pool<span class="token operator">=</span><span class="token string">'catavgmax'</span><span class="token punctuation">)</span>

num_in_features <span class="token operator">=</span> model<span class="token punctuation">.</span>get_classifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>in_features
<span class="token keyword">print</span><span class="token punctuation">(</span>num_in_features<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>get_classifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token number">4096</span>
Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>model<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
    nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span>num_in_features<span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span>num_in_features<span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span>NUM_FINETUNE_CLASSES<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>get_classifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

Sequential<span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> BatchNorm1d<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-05</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> track_running_stats<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span> BatchNorm1d<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-05</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> affine<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> track_running_stats<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>


model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape

torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="特征提取"><a href="#特征提取" class="header-anchor">#</a> 特征提取</h2> <blockquote><p>timm models also have consistent mechanisms for obtaining various types of intermediate features, which can be useful in order to use an architecture as a feature extractor for a downstream task; such as creating <a href="https://ieeexplore.ieee.org/document/8099589" target="_blank" rel="noopener noreferrer">feature pyramids in object detection<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></blockquote> <blockquote><p>Let’s visualise how this works by using an image from the <a href="https://www.robots.ox.ac.uk/~vgg/data/pets/" target="_blank" rel="noopener noreferrer">Oxford pets dataset<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></blockquote> <p>timm模型也提供了多种方法去获得中间层输出的结果：</p> <p>这里的Oxford pets dataset可以通过torchvision.datasets数据集进行下载：</p> <div class="language-python extra-class"><pre class="language-python"><code>OxfordIIITPet_dataset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>OxfordIIITPet<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'data'</span><span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>OxfordIIITPet_dataset<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">3669</span>

image <span class="token operator">=</span> OxfordIIITPet_dataset<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
to_tensor <span class="token operator">=</span> transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
image_tensor <span class="token operator">=</span> to_tensor<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
image_tensor <span class="token operator">=</span> image_tensor<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'image_tensor.shape: </span><span class="token interpolation"><span class="token punctuation">{</span>image_tensor<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

image_tensor<span class="token punctuation">.</span>shape<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">383</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/learning-blogs/assets/img/pet.7368c071.png" alt=""></p> <p>这里重新创建一个restnet50d模型：</p> <div class="language-python extra-class"><pre class="language-python"><code>model <span class="token operator">=</span> timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">'resnet50d'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><p>如果我们只对最后的feature map感兴趣，也就是最后的卷积层输出的结果，我们可以使用<code>forward_features</code>方法。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">visualize_feature_output</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>feature_output<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

feature_output <span class="token operator">=</span> model<span class="token punctuation">.</span>forward_features<span class="token punctuation">(</span>image_tensor<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'feature_output: </span><span class="token interpolation"><span class="token punctuation">{</span>feature_output<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'feature_output_transpose: </span><span class="token interpolation"><span class="token punctuation">{</span>feature_output<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'feature_output_transpose_sum: </span><span class="token interpolation"><span class="token punctuation">{</span>feature_output<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

feature_output<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
feature_output_transpose<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
feature_output_transpose_sum<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
visualize_feature_output<span class="token punctuation">(</span>feature_output<span class="token punctuation">)</span>
</code></pre></div><p><img src="data:image/png;base64,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NZ772W8LSEUn2BsH/vKXv3jFU0nKgYaGBgYMGHDY20+4IGSzWXbs2EFZWRmpVOqofm1LSwvV1dU0NDR85gX1TmZd/T529fsH3seu4mS6j1EUsWvXLqqqqujW7fBn0ifcU0bdunX7zIIdiZ49e57wf0HHq6vfx65+/8D72FWcLPexvLz8c4/xRWVJEmAQJEmxLhWEdDrNAw880KU/cKer38eufv/A+9hVdMX7eMK9qCxJyo8udYYgSTp2BkGSBBgESVLMIEiSgC4UhMcee4yamhpKSkoYMWIEr776ar6XlJi6ujouuOACysrK6NevH9dccw2bNm3K97Jyqq6ujlQqxZQpU/K9lER98MEH3HzzzfTp04fu3btz3nnnsWbNmnwvKzFtbW3cd9991NTUUFpayuDBg3nwwQfJZrP5XtoxW7lyJePHj6eqqopUKsWzzz7b6fYoipg1axZVVVWUlpYyZswYNm7cmJ/FHqcuEYSlS5cyZcoUZs6cybp167j44osZO3Ys27dvz/fSErFixQomTZrEG2+8QX19PW1tbdTW1rJnz558Ly0nVq1axcKFCznnnHPyvZREffTRR4waNYqioiKef/553nnnHX7yk5/Qq1evfC8tMQ8//DCPP/448+fP509/+hOPPPIIP/rRj3j00UfzvbRjtmfPHs4991zmz59/yNsfeeQR5s6dy/z581m1ahWVlZVceeWV7Nq1K/BKExB1ARdeeGF0xx13dNo3dOjQaPr06XlaUW41NTVFQLRixYp8LyVxu3btioYMGRLV19dHl156aTR58uR8Lykx06ZNi0aPHp3vZeTUuHHjottuu63TvmuvvTa6+eab87SiZAHRM8880/F1NpuNKisro4ceeqhj3/79+6Py8vLo8ccfz8MKj89Jf4Zw4MAB1qxZQ21tbaf9tbW1vP7663laVW41NzcD0Lt37zyvJHmTJk1i3LhxXHHFFfleSuKWL1/OyJEjue666+jXrx/Dhw/niSeeyPeyEjV69GhefPFFNm/eDMBbb73Fa6+9xlVXXZXnleXG1q1baWxs7PT4k06nufTSS0/Kx58T7uJ2R2vnzp20t7dTUVHRaX9FRQWNjY15WlXuRFHE1KlTGT16NMOGDcv3chL19NNPs3btWlatWpXvpeTE+++/z4IFC5g6dSrf//73efPNN7n77rtJp9Pccsst+V5eIqZNm0ZzczNDhw6loKCA9vZ2Zs+ezQ033JDvpeXEJ48xh3r82bZtWz6WdFxO+iB84p8vlR1F0VFfPvtkcOedd/L222/z2muv5XspiWpoaGDy5Mm88MILlJSU5Hs5OZHNZhk5ciRz5swBYPjw4WzcuJEFCxZ0mSAsXbqUxYsXs2TJEs466yzWr1/PlClTqKqqYsKECfleXs50lcefkz4Iffv2paCg4KCzgaampoOqfbK76667WL58OStXrjzuS4SfaNasWUNTUxMjRozo2Nfe3s7KlSuZP38+mUyGgoKCPK7w+PXv358zzzyz074zzjiDX//613laUfLuuecepk+fzvXXXw/A2WefzbZt26irq+uSQaisrAQ+PlPo379/x/6T9fHnpH8Nobi4mBEjRlBfX99pf319PRdddFGeVpWsKIq48847WbZsGS+99BI1NTX5XlLiLr/8cjZs2MD69es7tpEjR3LTTTexfv36kz4GAKNGjTrox4U3b97MoEGD8rSi5O3du/egD2ApKCg4qX/s9LPU1NRQWVnZ6fHnwIEDrFix4uR8/Mnva9rJePrpp6OioqLo5z//efTOO+9EU6ZMiXr06BH9+c9/zvfSEvHd7343Ki8vj1555ZXoww8/7Nj27t2b76XlVFf7KaM333wzKiwsjGbPnh29++670a9+9auoe/fu0eLFi/O9tMRMmDAhOu2006Lnnnsu2rp1a7Rs2bKob9++0b333pvvpR2zXbt2RevWrYvWrVsXAdHcuXOjdevWRdu2bYuiKIoeeuihqLy8PFq2bFm0YcOG6IYbboj69+8ftbS05HnlR69LBCGKouhnP/tZNGjQoKi4uDg6//zzu9SPZAKH3J588sl8Ly2nuloQoiiKfvvb30bDhg2L0ul0NHTo0GjhwoX5XlKiWlpaosmTJ0cDBw6MSkpKosGDB0czZ86MMplMvpd2zF5++eVD/vubMGFCFEUf/+jpAw88EFVWVkbpdDq65JJLog0bNuR30cfIy19LkoAu8BqCJCkZBkGSBBgESVLMIEiSAIMgSYoZBEkSYBAkSTGDIEkCDIIkKWYQJEmAQZAkxQyCJAmA/wfTS4UL+Ih5oQAAAABJRU5ErkJggg==" alt=""></p> <h3 id="输出多层特征"><a href="#输出多层特征" class="header-anchor">#</a> 输出多层特征</h3> <p>尽管<code>forward_features</code>能够很方便的提取最后的特征图谱，timm同时也提供了其他的功能输出不同level的特征。</p> <blockquote><p>We can specify that we would like to use a model as a feature backbone by using the argument features_only=True when creating a model. By default, 5 strides will be output from most models (not all have that many), with the first starting at 2 (but some start at 1 or 4).</p></blockquote> <p>可以通过传参<code>features_only=True</code> 来让该模型输出特征，默认情况下输出5层特征。</p> <div class="language-python extra-class"><pre class="language-python"><code>model <span class="token operator">=</span> timm<span class="token punctuation">.</span>create_model<span class="token punctuation">(</span><span class="token string">'resnet50d'</span><span class="token punctuation">,</span> pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> features_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'module name: </span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">.</span>feature_info<span class="token punctuation">.</span>module_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'reduction:</span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">.</span>feature_info<span class="token punctuation">.</span>reduction<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'channels:</span><span class="token interpolation"><span class="token punctuation">{</span>model<span class="token punctuation">.</span>feature_info<span class="token punctuation">.</span>channels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

module name<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'act1'</span><span class="token punctuation">,</span> <span class="token string">'layer1'</span><span class="token punctuation">,</span> <span class="token string">'layer2'</span><span class="token punctuation">,</span> <span class="token string">'layer3'</span><span class="token punctuation">,</span> <span class="token string">'layer4'</span><span class="token punctuation">]</span>
reduction<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span>
channels<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>out <span class="token operator">=</span> model<span class="token punctuation">(</span>image_tensor<span class="token punctuation">)</span>
<span class="token keyword">for</span> o <span class="token keyword">in</span> out<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> o <span class="token keyword">in</span> out<span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>o<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/learning-blogs/assets/img/features_1.404425ab.png" alt=""></p> <p><img src="/learning-blogs/assets/img/features_2.ed5f1095.png" alt=""></p> <p><img src="/learning-blogs/assets/img/features_3.68c2afb5.png" alt=""></p> <p><img src="data:image/png;base64,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" alt=""></p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAb8AAAGdCAYAAACCd31PAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjguNCwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8fJSN1AAAACXBIWXMAAA9hAAAPYQGoP6dpAAAbD0lEQVR4nO3df3DU9b3v8ddmk2wSXKLBJiElYLg3R5CgIrE9AiqOmhlEWsdbLQLKaNuRQ1QiZyyk+APtkK205TBjSpx47lg6TJA7t6K0U1tTRdBRxpiAcmkvFM2BKKYpPXTDryxJ9nv+6E3uRAgS+H73Q3k/HzP7R775kvfnmx/75LvJ7jfkeZ4nAAAMSXO9AAAAUo34AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwJx01wv4omQyqQMHDigajSoUCrleDgDgH4jneTp8+LCKioqUljb4+d15F78DBw6ouLjY9TIAAP/A2traNGrUqEHff97FLxqNSpL++4InFY5kpXz+jLveS/nMPv+7pdzZ7HH/dtDJ3N5P253MlaRQ2N0jC8muhLPZMvqISjh6kZO5yePuvtahrExns49f909O5vb0dKnpzVh/SwZz3sWv76HOcCTLSfwiF2WkfGaftOzUH2+f9LSIk7mhkLvPdyjk7lfeyVDS2Wyz8Qu5CYHLr3XI0TFLUnqGu/szSV/6azP+4AUAYA7xAwCYQ/wAAOYQPwCAOcQPAGAO8QMAmEP8AADmED8AgDmBxW/NmjUqKSlRVlaWJk+erLfffjuoUQAADEkg8duwYYOqqqq0bNkybd++Xddff71mzJih/fv3BzEOAIAhCSR+q1at0ne+8x1997vf1fjx47V69WoVFxerrq4uiHEAAAyJ7/E7ceKEmpubVVFRMWB7RUWF3n333ZP2TyQS6uzsHHADACBIvsfv4MGD6u3tVUFBwYDtBQUFam8/+RX8Y7GYcnNz+29czggAELTA/uDli6+o7XneKV9lu7q6WvF4vP/W1tYW1JIAAJAUwCWNLr30UoXD4ZPO8jo6Ok46G5SkSCSiSMTN5XQAADb5fuaXmZmpyZMnq7GxccD2xsZGTZkyxe9xAAAMWSAXs128eLHuvfdelZeX67rrrlN9fb3279+vBQsWBDEOAIAhCSR+3/72t/XXv/5VzzzzjD7//HOVlZXpN7/5jcaMGRPEOAAAhiSQ+EnSwoULtXDhwqA+PAAAZ43X9gQAmEP8AADmED8AgDnEDwBgDvEDAJhD/AAA5hA/AIA5xA8AYE5gT3I/V9sq/13Do6lv85FkV8pn9vlfF13jbLaOHXcytvuGiU7mStK+2zKczb783xxevcTz3I2+KMfZ7D9P/4qTuZfsTjiZK0mZu9x9n2XGu53MTes5s7mc+QEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc9JdL2Aw/+Nbdyk9HEn53NDxEymf2eef/trmbHbv3+JO5mbtcjJWknT5x6n//uoXdvf/zgO3Fzub3ZPjbLS+sj3hZO6hy919n43o/qqz2ec7zvwAAOYQPwCAOcQPAGAO8QMAmEP8AADmED8AgDnEDwBgDvEDAJhD/AAA5hA/AIA5vscvFovp2muvVTQaVX5+vu644w7t3r3b7zEAAJw13+O3ZcsWVVZWatu2bWpsbFRPT48qKip09OhRv0cBAHBWfH9h69/+9rcD3n7xxReVn5+v5uZm3XDDDX6PAwBgyAL/nV88/verBeTl5QU9CgCAMxLoJY08z9PixYs1bdo0lZWVnXKfRCKhROL/X2qks7MzyCUBABDsmd9DDz2kjz76SOvXrx90n1gsptzc3P5bcbG7a40BAGwILH4PP/ywNm3apM2bN2vUqFGD7lddXa14PN5/a2tzd0FXAIANvj/s6XmeHn74YW3cuFFvvfWWSkpKTrt/JBJRJOLwitoAAHN8j19lZaUaGhr06quvKhqNqr29XZKUm5ur7Oxsv8cBADBkvj/sWVdXp3g8runTp2vkyJH9tw0bNvg9CgCAsxLIw54AAJzPeG1PAIA5xA8AYA7xAwCYQ/wAAOYQPwCAOcQPAGAO8QMAmEP8AADmBHpJo3OR/D9/UjKUkfK5acNyUj6zj9eV+PKdApKW4+a4k3+LO5krSSGHL7f3+ZzxzmbX/etzzmb/y865zmZnbEn9/YkkFf62w8lcSfKOdTmbrdyL3MztPbP7Uc78AADmED8AgDnEDwBgDvEDAJhD/AAA5hA/AIA5xA8AYA7xAwCYQ/wAAOYQPwCAOcQPAGAO8QMAmEP8AADmED8AgDnEDwBgDvEDAJhD/AAA5hA/AIA5xA8AYA7xAwCYQ/wAAOYQPwCAOcQPAGAO8QMAmEP8AADmED8AgDnEDwBgDvEDAJhD/AAA5hA/AIA56a4XMKhkrxRKfZtD6e4+JaFh7v4vkjx63MncUFbEyVxJkpd0Nvpv5Qlns6s/vtPZ7K4TGc5mhw93OZnrRTKdzJUkXZTjbPSR0lwnc3u6u6RPvnw/zvwAAOYQPwCAOcQPAGAO8QMAmEP8AADmED8AgDnEDwBgDvEDAJhD/AAA5hA/AIA5xA8AYE7g8YvFYgqFQqqqqgp6FAAAZyTQ+DU1Nam+vl5XXnllkGMAABiSwOJ35MgRzZ07Vy+88IIuueSSoMYAADBkgcWvsrJSM2fO1C233HLa/RKJhDo7OwfcAAAIUiAXr3vppZfU0tKipqamL903Fovp6aefDmIZAACcku9nfm1tbVq0aJHWrVunrKysL92/urpa8Xi8/9bW1ub3kgAAGMD3M7/m5mZ1dHRo8uTJ/dt6e3u1detW1dbWKpFIKBwO978vEokoEnF4NW8AgDm+x+/mm2/Wzp07B2y7//77NW7cOC1ZsmRA+AAAcMH3+EWjUZWVlQ3YNmzYMI0YMeKk7QAAuMArvAAAzAnkrz2/6K233krFGAAAzghnfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzEnJk9zPRviSixUOZaZ8rnf8eMpn9s/u6XE2O5SZ+s+1JKm7281cScmupLPZl4066Gz2wcavOpt9yX53n3P95YCbuQ5fzzg56ivOZndnuzm36k0/s7mc+QEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc9JdL2Awn3/7coUjWSmfW/Sbz1M+s9+BP7ubHQ47GRvKTv3XuF9XwtnozCdync0+Vnnc2ezRvzjgbHbymJvjDmVmOJkrSeGDnc5m53XEncztSZ7ZzzVnfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwJ5D4ffbZZ5o3b55GjBihnJwcXX311Wpubg5iFAAAQ+b7C1sfOnRIU6dO1U033aTXXntN+fn5+vjjj3XxxRf7PQoAgLPie/yeffZZFRcX68UXX+zfdtlll/k9BgCAs+b7w56bNm1SeXm57rrrLuXn52vSpEl64YUXBt0/kUios7NzwA0AgCD5Hr9PPvlEdXV1Ki0t1e9+9zstWLBAjzzyiH7xi1+ccv9YLKbc3Nz+W3Fxsd9LAgBgAN/jl0wmdc0116impkaTJk3Sgw8+qO9973uqq6s75f7V1dWKx+P9t7a2Nr+XBADAAL7Hb+TIkbriiisGbBs/frz2799/yv0jkYiGDx8+4AYAQJB8j9/UqVO1e/fuAdv27NmjMWPG+D0KAICz4nv8Hn30UW3btk01NTXau3evGhoaVF9fr8rKSr9HAQBwVnyP37XXXquNGzdq/fr1Kisr0w9/+EOtXr1ac+fO9XsUAABnxffn+UnS7bffrttvvz2IDw0AwDnjtT0BAOYQPwCAOcQPAGAO8QMAmEP8AADmED8AgDnEDwBgDvEDAJgTyJPc/ZD3fxNKTw+5XkZKhTIz3A1Pd/OtEHI0V5JCue5eRD3tz3Fnsy95q8jZ7BOXu5vdcXW2k7l5u7udzJWktO6ks9n7KzKdzE12dUlPfvl+nPkBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHPSXS9gMBnv/VHpoYyUz/UyM1M+s08o4m62wmE3czNS/zXuc2RCvrPZf7nS3Y9e5Gv/6Wx224eXOJs99qWDTub2XJLjZK4kdUfd/XyV/s8OJ3N7ehP6jzPYjzM/AIA5xA8AYA7xAwCYQ/wAAOYQPwCAOcQPAGAO8QMAmEP8AADmED8AgDnEDwBgju/x6+np0eOPP66SkhJlZ2dr7NixeuaZZ5RMJv0eBQDAWfH9BQafffZZPf/881q7dq0mTJigDz74QPfff79yc3O1aNEiv8cBADBkvsfvvffe0ze/+U3NnDlTknTZZZdp/fr1+uCDD/weBQDAWfH9Yc9p06bpjTfe0J49eyRJH374od555x3ddtttp9w/kUios7NzwA0AgCD5fua3ZMkSxeNxjRs3TuFwWL29vVqxYoXuueeeU+4fi8X09NNP+70MAAAG5fuZ34YNG7Ru3To1NDSopaVFa9eu1U9+8hOtXbv2lPtXV1crHo/339ra2vxeEgAAA/h+5vfYY49p6dKlmj17tiRp4sSJ2rdvn2KxmObPn3/S/pFIRJFIxO9lAAAwKN/P/I4dO6a0tIEfNhwO81QHAMB5w/czv1mzZmnFihUaPXq0JkyYoO3bt2vVqlV64IEH/B4FAMBZ8T1+zz33nJ544gktXLhQHR0dKioq0oMPPqgnn3zS71EAAJwV3+MXjUa1evVqrV692u8PDQCAL3htTwCAOcQPAGAO8QMAmEP8AADmED8AgDnEDwBgDvEDAJhD/AAA5vj+JHe/eImEvFDqXw/U6+5J+cw+ab29zmb/7Y4rnczNe7PVyVxJkududGHTCWezW0cNdza7YLe7T3oyJ9PJ3IyPP3cyV5LSc6POZusv/+lmrndmP1uc+QEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc9JdL2Aw4UsvVTgtM+VzQ+nhlM/s40WHOZvdkxVyMvfwP49xMleSLnp7r7PZ3qgCZ7O/+sZwZ7MzjvQ6m9353y5yMvfiYyeczJUkeZ6z0cmxRW7m9iakQ1++H2d+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADBnyPHbunWrZs2apaKiIoVCIb3yyisD3u95npYvX66ioiJlZ2dr+vTp2rVrl1/rBQDgnA05fkePHtVVV12l2traU75/5cqVWrVqlWpra9XU1KTCwkLdeuutOnz48DkvFgAAPwz5qg4zZszQjBkzTvk+z/O0evVqLVu2THfeeackae3atSooKFBDQ4MefPDBc1stAAA+8PV3fq2trWpvb1dFRUX/tkgkohtvvFHvvvvuKf9NIpFQZ2fngBsAAEHyNX7t7e2SpIKCgdcqKygo6H/fF8ViMeXm5vbfiouL/VwSAAAnCeSvPUOhgRdG9TzvpG19qqurFY/H+29tbW1BLAkAgH6+Xsm9sLBQ0t/PAEeOHNm/vaOj46SzwT6RSESRSMTPZQAAcFq+nvmVlJSosLBQjY2N/dtOnDihLVu2aMqUKX6OAgDgrA35zO/IkSPau3dv/9utra3asWOH8vLyNHr0aFVVVammpkalpaUqLS1VTU2NcnJyNGfOHF8XDgDA2Rpy/D744APddNNN/W8vXrxYkjR//nz9/Oc/1/e//30dP35cCxcu1KFDh/T1r39dr7/+uqLRqH+rBgDgHAw5ftOnT5fneYO+PxQKafny5Vq+fPm5rAsAgMDw2p4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMzx9YWt/dQ57TKlZ2SlfG7GkWTKZ/aJ/H67s9l5e//DydxQhsNvwezUf3/1CX36Z2ezh3f3OputA+6OOzvdzfda8vARJ3MlSb3uvtZeT4+buV73Ge3HmR8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMAc4gcAMIf4AQDMIX4AAHOIHwDAHOIHADCH+AEAzCF+AABziB8AwBziBwAwh/gBAMwhfgAAc4gfAMCcdNcL+CLP8yRJvd1dTuaHupNO5kpS2Ot2Nrvv855qIUdzJSnNc/h/v2TY3ezehLvZ3gl3s5NufraTDn+u5fW6G+31OJnbo+7/N//09y0hz9W93iA+/fRTFRcXu14GAOAfWFtbm0aNGjXo+8+7+CWTSR04cEDRaFShUGjI/76zs1PFxcVqa2vT8OHDA1jh+cfiMUsct6XjtnjMks3jPtdj9jxPhw8fVlFRkdLSBn9057x72DMtLe20tT5Tw4cPN/PN0sfiMUsctyUWj1myedzncsy5ublfug9/8AIAMIf4AQDMueDiF4lE9NRTTykSibheSspYPGaJ47Z03BaPWbJ53Kk65vPuD14AAAjaBXfmBwDAlyF+AABziB8AwBziBwAw54KK35o1a1RSUqKsrCxNnjxZb7/9tuslBSoWi+naa69VNBpVfn6+7rjjDu3evdv1slIqFospFAqpqqrK9VIC99lnn2nevHkaMWKEcnJydPXVV6u5udn1sgLV09Ojxx9/XCUlJcrOztbYsWP1zDPPKOnodTqDsnXrVs2aNUtFRUUKhUJ65ZVXBrzf8zwtX75cRUVFys7O1vTp07Vr1y43i/XJ6Y65u7tbS5Ys0cSJEzVs2DAVFRXpvvvu04EDB3ybf8HEb8OGDaqqqtKyZcu0fft2XX/99ZoxY4b279/vemmB2bJliyorK7Vt2zY1Njaqp6dHFRUVOnr0qOulpURTU5Pq6+t15ZVXul5K4A4dOqSpU6cqIyNDr732mv7whz/opz/9qS6++GLXSwvUs88+q+eff161tbX64x//qJUrV+rHP/6xnnvuOddL89XRo0d11VVXqba29pTvX7lypVatWqXa2lo1NTWpsLBQt956qw4fPpzilfrndMd87NgxtbS06IknnlBLS4tefvll7dmzR9/4xjf8W4B3gfja177mLViwYMC2cePGeUuXLnW0otTr6OjwJHlbtmxxvZTAHT582CstLfUaGxu9G2+80Vu0aJHrJQVqyZIl3rRp01wvI+VmzpzpPfDAAwO23Xnnnd68efMcrSh4kryNGzf2v51MJr3CwkLvRz/6Uf+2rq4uLzc313v++ecdrNB/XzzmU3n//fc9Sd6+fft8mXlBnPmdOHFCzc3NqqioGLC9oqJC7777rqNVpV48Hpck5eXlOV5J8CorKzVz5kzdcsstrpeSEps2bVJ5ebnuuusu5efna9KkSXrhhRdcLytw06ZN0xtvvKE9e/ZIkj788EO98847uu222xyvLHVaW1vV3t4+4P4tEonoxhtvNHf/FgqFfHu047x7YeuzcfDgQfX29qqgoGDA9oKCArW3tztaVWp5nqfFixdr2rRpKisrc72cQL300ktqaWlRU1OT66WkzCeffKK6ujotXrxYP/jBD/T+++/rkUceUSQS0X333ed6eYFZsmSJ4vG4xo0bp3A4rN7eXq1YsUL33HOP66WlTN992Knu3/bt2+diSSnX1dWlpUuXas6cOb69wPcFEb8+X7wEkud5Z3VZpH9EDz30kD766CO98847rpcSqLa2Ni1atEivv/66srKyXC8nZZLJpMrLy1VTUyNJmjRpknbt2qW6uroLOn4bNmzQunXr1NDQoAkTJmjHjh2qqqpSUVGR5s+f73p5KWX1/q27u1uzZ89WMpnUmjVrfPu4F0T8Lr30UoXD4ZPO8jo6Ok7639KF6OGHH9amTZu0detWXy4HdT5rbm5WR0eHJk+e3L+tt7dXW7duVW1trRKJhMJhh1dJD8jIkSN1xRVXDNg2fvx4/fKXv3S0otR47LHHtHTpUs2ePVuSNHHiRO3bt0+xWMxM/AoLCyX9/Qxw5MiR/dst3L91d3fr7rvvVmtrq958801fL+t0QfzOLzMzU5MnT1ZjY+OA7Y2NjZoyZYqjVQXP8zw99NBDevnll/Xmm2+qpKTE9ZICd/PNN2vnzp3asWNH/628vFxz587Vjh07LsjwSdLUqVNPehrLnj17NGbMGEcrSo1jx46ddEHScDh8wT3V4XRKSkpUWFg44P7txIkT2rJlywV9/9YXvj/96U/6/e9/rxEjRvj68S+IMz9JWrx4se69916Vl5fruuuuU319vfbv368FCxa4XlpgKisr1dDQoFdffVXRaLT/zDc3N1fZ2dmOVxeMaDR60u80hw0bphEjRlzQv+t89NFHNWXKFNXU1Ojuu+/W+++/r/r6etXX17teWqBmzZqlFStWaPTo0ZowYYK2b9+uVatW6YEHHnC9NF8dOXJEe/fu7X+7tbVVO3bsUF5enkaPHq2qqirV1NSotLRUpaWlqqmpUU5OjubMmeNw1efmdMdcVFSkb33rW2ppadGvf/1r9fb29t+/5eXlKTMz89wX4MvfjJ4nfvazn3ljxozxMjMzvWuuueaC/5N/Sae8vfjii66XllIWnurgeZ73q1/9yisrK/MikYg3btw4r76+3vWSAtfZ2ektWrTIGz16tJeVleWNHTvWW7ZsmZdIJFwvzVebN28+5c/y/PnzPc/7+9MdnnrqKa+wsNCLRCLeDTfc4O3cudPtos/R6Y65tbV10Pu3zZs3+zKfSxoBAMy5IH7nBwDAUBA/AIA5xA8AYA7xAwCYQ/wAAOYQPwCAOcQPAGAO8QMAmEP8AADmED8AgDnEDwBgDvEDAJjzX2stdDF+JmuqAAAAAElFTkSuQmCC" alt=""></p> <h3 id="使用torch-fx"><a href="#使用torch-fx" class="header-anchor">#</a> 使用Torch FX</h3> <p>TODO</p> <h2 id="导出多种格式文件"><a href="#导出多种格式文件" class="header-anchor">#</a> 导出多种格式文件</h2> <p>TODO</p> <h2 id="data-augmentation"><a href="#data-augmentation" class="header-anchor">#</a> Data Augmentation</h2> <p>类似于torchvision, timm拥有很多种数据增强的方法，这里方法可以被连起来形成pipelines.</p> <p>最简单的方式就是使用<code>create_transform</code>工厂方法</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> timm<span class="token punctuation">.</span>data<span class="token punctuation">.</span>transforms_factory <span class="token keyword">import</span> create_transform
create_transform<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span><span class="token punctuation">)</span>

Compose<span class="token punctuation">(</span>
    Resize<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>bilinear<span class="token punctuation">,</span> max_size<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> antialias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    CenterCrop<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Normalize<span class="token punctuation">(</span>mean<span class="token operator">=</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.4850</span><span class="token punctuation">,</span> <span class="token number">0.4560</span><span class="token punctuation">,</span> <span class="token number">0.4060</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">=</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.2290</span><span class="token punctuation">,</span> <span class="token number">0.2240</span><span class="token punctuation">,</span> <span class="token number">0.2250</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

create_transform<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> is_training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

Compose<span class="token punctuation">(</span>
    RandomResizedCropAndInterpolation<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ratio<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">1.3333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>bilinear<span class="token punctuation">)</span>
    RandomHorizontalFlip<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    ColorJitter<span class="token punctuation">(</span>brightness<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">1.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> contrast<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">1.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> saturation<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">1.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hue<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
    ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Normalize<span class="token punctuation">(</span>mean<span class="token operator">=</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.4850</span><span class="token punctuation">,</span> <span class="token number">0.4560</span><span class="token punctuation">,</span> <span class="token number">0.4060</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">=</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.2290</span><span class="token punctuation">,</span> <span class="token number">0.2240</span><span class="token punctuation">,</span> <span class="token number">0.2250</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>这里我们可以看到通过一个<code>create_transform</code>工厂函数，我们可以很轻易的创建一个基础的数据增强pipeline 包括resizing, 归一化 和将图片变为tensor格式。</p> <p>同时正如我们期待的：通过将<code>is_training=True</code>一些额外的转变被添加进去，比如水平翻转， 颜色调增等等。这里增强的强度可以被如<code>hflip, vflip, color_jitter</code>等参数进行调整。</p> <p>其次，我们看到用于resize图片等方法也是根据是否在训练， 尽Resize和CenterCrop在validation时候被使用，但是当训练的时候，RandomResizedCropAndInterpolation会被调用。</p> <p>下面我们看看如何使用<code>RandomResizedCropAndInterpolation</code>:</p> <div class="language-python extra-class"><pre class="language-python"><code>OxfordIIITPet_dataset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>OxfordIIITPet<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'data'</span><span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>OxfordIIITPet_dataset<span class="token punctuation">)</span><span class="token punctuation">)</span>
image <span class="token operator">=</span> OxfordIIITPet_dataset<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span> OxfordIIITPet_dataset<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
image

<span class="token number">3669</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span>PIL<span class="token punctuation">.</span>Image<span class="token punctuation">.</span>Image image mode<span class="token operator">=</span>RGB size<span class="token operator">=</span>400x383 at <span class="token number">0x177FA3770</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/learning-blogs/assets/img/pet.7368c071.png" alt=""></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> timm<span class="token punctuation">.</span>data<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> RandomResizedCropAndInterpolation
tfm <span class="token operator">=</span> RandomResizedCropAndInterpolation<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">350</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span><span class="token string">'random'</span><span class="token punctuation">)</span>

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> idx<span class="token punctuation">,</span> im <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tfm<span class="token punctuation">(</span>image<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> idx<span class="token punctuation">]</span><span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>im<span class="token punctuation">)</span>

<span class="token keyword">for</span> idx<span class="token punctuation">,</span> im <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tfm<span class="token punctuation">(</span>image<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> idx<span class="token punctuation">]</span><span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>im<span class="token punctuation">)</span>

fig<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/learning-blogs/assets/img/RandomResizedCropAndInterpolation.f8f90640.png" alt=""></p> <p>通过多次运行这个命令，我们可以看到不同的剪裁方式被应用。尽然这个方法在训练的时候是有益的，但同时也对让evaluation阶段更难。</p> <p>取决于不同类型的图片，这种转变方式可能会导致图片的物体被裁减出图片范围。比如第一行的第二张图片，但是这个并不是大问题，因为可以通过scale参数进行调整。</p> <div class="language- extra-class"><pre class="language-text"><code>tfm = RandomResizedCropAndInterpolation(size=224, scale=(0.8, 1))
random_image = tfm(image)
print(random_image)
random_image

&lt;PIL.Image.Image image mode=RGB size=224x224 at 0x1781205C0&gt;
</code></pre></div><p><img src="/learning-blogs/assets/img/scale.0c084d98.png" alt=""></p> <h3 id="randaugment"><a href="#randaugment" class="header-anchor">#</a> RandAugment</h3> <p>当开始一个新的任务的时候，很难去选择使用哪种增强方法，以及使用哪种顺序，目前有很多种选择。通常来说，一个好的办法是使用一个在特定任务里已经被证实有效的数据增强pipeline。一个策略是使用<code>RandAugment</code> 这是一个自动的数据增强pipeline。</p> <blockquote><p>an automated data augmentation method that uniformly samples operations from a set of augmentations — such as equalization, rotation, solarization, color jittering, posterizing, changing contrast, changing brightness, changing sharpness, shearing, and translations — and applies a number of these sequentially; for more info, see <a href="https://arxiv.org/abs/1909.13719" target="_blank" rel="noopener noreferrer">the original paper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></blockquote> <p>However, there are several key differences in the implementation provided in timm, which are best described by timm’s creator Ross Wightman in the appendix of the <a href="https://arxiv.org/pdf/2110.00476v1" target="_blank" rel="noopener noreferrer">ResNets Strike Back paper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which I paraphrase below:</p> <blockquote><p>The original RandAugment specification has two hyper-parameters, M and N; where M is the distortion magnitude and N is the number of distortions uniformly sampled and applied per-image. The goal of RandAugment was that <strong>both M and N be human interpretable</strong>.</p> <p>However, that ended up not being the case for M [in the original implementation]. The scales of several augmentations were backwards or not monotonically increasing over the range such that increasing M does not increase the strength of all augmentations.</p></blockquote> <p>In the original implementation, whilst some augmentations go up in strength as M increases, others decrease or are removed entirely, such that each M essentially represents its own policy.</p> <blockquote><p>The implementation in timm attempts to improve this situation by adding <code>an ‘increasing’ mode [enabled by default] where all augmentation strengths increase with magnitude</code>.</p></blockquote> <p>This makes increasing M more intuitive, as all augmentations should now decrease/increase in strength with corresponding decrease/increase in M.</p> <blockquote><p>[Additionally,] timm adds a <code>MSTD parameter</code>, which adds <strong>gaussian noise</strong> with the specified standard deviation to the M value per distortion application. If MSTD is set to ‘-inf’, M is uniformly sampled from 0-M for each distortion.</p></blockquote> <blockquote><p>Care was taken in timm’s RandAugment to reduce impact on image mean, the normalization parameters can be passed as a parameter such that all augmentations that may introduce border pixels can use the specified mean instead of defaulting to 0 or a hard-coded tuple as in other implementations.</p></blockquote> <blockquote><p>[Lastly,] Cutout is excluded by default to favour separate use of timm’s Random Erasing implementation* which has less
impact on mean and standard deviation of the augmented images.</p></blockquote> <p>*The implementation of Random Erasing in timm is explored <a href="https://timm.fast.ai/RandomErase" target="_blank" rel="noopener noreferrer">in detail here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>In timm, we define the parameters of our RandAugment policy by using a config string; which consists of multiple sections separated by dashes (-)</p> <p>The first section defines the specific variant of rand augment (currently only <code>rand</code> is supported). The remaining sections, which can be placed in any order, are:</p> <ul><li>m (integer): the magnitude of rand augment</li> <li>n (integer): the number of transform ops selected per image, this is optional with default set at 2</li> <li>mstd (float): the standard deviation of the magnitude noise applied</li> <li>mmax (integer): sets the upper bound for magnitude to something other than the default of 10</li> <li>w (integer): the probability weight index (index of a set of weights to influence choice of operation)</li> <li>inc (bool — {0, 1}): use augmentations that increase in severity with magnitude, this is optional with the default of 0</li></ul> <p>For example:</p> <ul><li>rand-m9-n3-mstd0.5: results in RandAugment with magnitude 9, 3 augmentations per image, mstd 0.5</li> <li>rand-mstd1-w0: results in mstd 1.0, weights 0, default magnitude m of 10, and 2 augmentations per image</li></ul> <p>Passing a config string to <code>create_transform</code>, we can see that this is handled by the <code>RandAugment</code> object, and we can see the names of all available ops:</p> <div class="language-python extra-class"><pre class="language-python"><code>create_transform<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> is_training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> auto_augment<span class="token operator">=</span><span class="token string">'rand-m9-mstd0.5'</span><span class="token punctuation">)</span>

Compose<span class="token punctuation">(</span>
    RandomResizedCropAndInterpolation<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ratio<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">1.3333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>bilinear<span class="token punctuation">)</span>
    RandomHorizontalFlip<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    RandAugment<span class="token punctuation">(</span>n<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> ops<span class="token operator">=</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>AutoContrast<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Equalize<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Invert<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Rotate<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Posterize<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Solarize<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>SolarizeAdd<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Color<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Contrast<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Brightness<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Sharpness<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>ShearX<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>ShearY<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>TranslateXRel<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>TranslateYRel<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Normalize<span class="token punctuation">(</span>mean<span class="token operator">=</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.4850</span><span class="token punctuation">,</span> <span class="token number">0.4560</span><span class="token punctuation">,</span> <span class="token number">0.4060</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">=</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.2290</span><span class="token punctuation">,</span> <span class="token number">0.2240</span><span class="token punctuation">,</span> <span class="token number">0.2250</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>同时也可以使一个自定义的Pipeline <code>rand_augment_transform</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> timm<span class="token punctuation">.</span>data<span class="token punctuation">.</span>auto_augment <span class="token keyword">import</span> rand_augment_transform
tfm <span class="token operator">=</span> rand_augment_transform<span class="token punctuation">(</span>
    config_str<span class="token operator">=</span><span class="token string">'rand-m9-mstd0.5'</span><span class="token punctuation">,</span>
    hparams<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'img_mean'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
tfm

RandAugment<span class="token punctuation">(</span>n<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> ops<span class="token operator">=</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>AutoContrast<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Equalize<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Invert<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Rotate<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Posterize<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Solarize<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>SolarizeAdd<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Color<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Contrast<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Brightness<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>Sharpness<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>ShearX<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>ShearY<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>TranslateXRel<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
	AugmentOp<span class="token punctuation">(</span>name<span class="token operator">=</span>TranslateYRel<span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> mstd<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> idx<span class="token punctuation">,</span> im <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tfm<span class="token punctuation">(</span>image<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> idx<span class="token punctuation">]</span><span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>im<span class="token punctuation">)</span>

<span class="token keyword">for</span> idx<span class="token punctuation">,</span> im <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tfm<span class="token punctuation">(</span>image<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> idx<span class="token punctuation">]</span><span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>im<span class="token punctuation">)</span>

fig<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/learning-blogs/assets/img/rand_augment.69a1541d.png" alt=""></p> <h3 id="cutmix-and-mixup"><a href="#cutmix-and-mixup" class="header-anchor">#</a> CutMix and Mixup</h3> <blockquote><p>timm provides a flexible implementation of the <a href="https://arxiv.org/abs/1905.04899" target="_blank" rel="noopener noreferrer">CutMix<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://arxiv.org/abs/1710.09412" target="_blank" rel="noopener noreferrer">Mixup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> augmentations, using the Mixup class; which handles both augmentations and provides the option of switching between them.</p></blockquote> <p>Using <code>Mixup</code>, we can select from variety of different mixing strategies:</p> <ul><li>batch: CutMix vs Mixup selection, lambda, and CutMix region sampling are performed per batch</li> <li>pair: mixing, lambda, and region sampling are performed on sampled pairs within a batch</li> <li>elem: mixing, lambda, and region sampling are performed per image within batch</li> <li>half: the same as elementwise but one of each mixing pair is discarded so that each sample is seen once per epoch</li></ul> <p>Let’s visualise how this works. To do this, we will need to create a DataLoader, iterate through it and apply the augmentations to the batch. Once again, we shall use images from the Pets dataset.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> timm<span class="token punctuation">.</span>data <span class="token keyword">import</span> ImageDataset
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader

<span class="token keyword">def</span> <span class="token function">create_dataloader_iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dataset <span class="token operator">=</span> ImageDataset<span class="token punctuation">(</span><span class="token string">'data/oxford-iiit-pet/images'</span><span class="token punctuation">,</span> 
                           transform<span class="token operator">=</span>create_transform<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dl <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> dl

dataLoader <span class="token operator">=</span> create_dataloader_iterator<span class="token punctuation">(</span><span class="token punctuation">)</span>
inputs<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>dataLoader<span class="token punctuation">)</span>
inputs<span class="token punctuation">.</span>shape

torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">imshow</span><span class="token punctuation">(</span>inp<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Imshow for Tensor.&quot;&quot;&quot;</span>
    inp <span class="token operator">=</span> inp<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    mean <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.485</span><span class="token punctuation">,</span> <span class="token number">0.456</span><span class="token punctuation">,</span> <span class="token number">0.406</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    std <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.229</span><span class="token punctuation">,</span> <span class="token number">0.224</span><span class="token punctuation">,</span> <span class="token number">0.225</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    inp <span class="token operator">=</span> std <span class="token operator">*</span> inp <span class="token operator">+</span> mean
    inp <span class="token operator">=</span> np<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>inp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>inp<span class="token punctuation">)</span>
    <span class="token keyword">if</span> title <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>pause<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># pause a bit so that plots are updated</span>

out <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>make_grid<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># plt.imshow(out.permute(1, 2, 0)) # image heigth , image width, color channels</span>
imshow<span class="token punctuation">(</span>out<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token punctuation">[</span>x<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> classes<span class="token punctuation">]</span><span class="token punctuation">)</span>

torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">228</span><span class="token punctuation">,</span> <span class="token number">454</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/learning-blogs/assets/img/transform.ee45eccf.png" alt=""></p> <p>现在我们来创建MixUp transform:</p> <ul><li>mixup_alpha (float): mixup alpha value, mixup is active if &gt; 0., (default: 1)</li> <li>cutmix_alpha (float): cutmix alpha value, cutmix is active if &gt; 0. (default: 0)</li> <li>cutmix_minmax (List[float]): cutmix min/max image ratio, cutmix is active and uses this vs alpha if not None.</li> <li>prob (float): the probability of applying mixup or cutmix per batch or element (default: 1)</li> <li>switch_prob (float): the probability of switching to cutmix instead of mixup when both are active (default: 0.5)</li> <li>mode (str): how to apply mixup/cutmix params (default: batch)</li> <li>label_smoothing (float): the amount of label smoothing to apply to the mixed target tensor (default: 0.1)</li> <li>num_classes (int): the number of classes for the target variable</li></ul> <p>Let’s define a set of arguments so that we apply either mixup or cutmix to a batch of images, and alternate with the probability of 1, and use these to create our <code>Mixup</code> transformation:'</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> timm<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mixup <span class="token keyword">import</span> Mixup

mixup_args <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'mixup_alpha'</span><span class="token punctuation">:</span><span class="token number">1.</span><span class="token punctuation">,</span>
    <span class="token string">'cutmix_alpha'</span><span class="token punctuation">:</span><span class="token number">1.</span><span class="token punctuation">,</span>
    <span class="token string">'prob'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'switch_prob'</span><span class="token punctuation">:</span><span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token string">'mode'</span><span class="token punctuation">:</span><span class="token string">'batch'</span><span class="token punctuation">,</span>
    <span class="token string">'label_smoothing'</span><span class="token punctuation">:</span><span class="token number">0.1</span><span class="token punctuation">,</span>
    <span class="token string">'num_classes'</span><span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span>

mixup_fn <span class="token operator">=</span> Mixup<span class="token punctuation">(</span><span class="token operator">**</span> mixup_args<span class="token punctuation">)</span>
</code></pre></div><p>因为mixup和cutup能够作用于一批图片，所有我们可以将图片先放到GPU上，然后再进行增强，可以提高速度：</p> <div class="language-python extra-class"><pre class="language-python"><code>mixed_inputs<span class="token punctuation">,</span> mixed_classes <span class="token operator">=</span> mixup_fn<span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> classes<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">)</span>

out <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>make_grid<span class="token punctuation">(</span>mixed_inputs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># plt.imshow(out.permute(1, 2, 0)) # image heigth , image width, color channels</span>
imshow<span class="token punctuation">(</span>out<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token operator">=</span>mixed_classes<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/learning-blogs/assets/img/mixup.4fcec9a1.png" alt=""></p> <h2 id="datasets"><a href="#datasets" class="header-anchor">#</a> Datasets</h2> <p>通过<code>create_dataset</code>命令创建数据集，有几个参数需要指定：</p> <ul><li>name: 数据集名称</li> <li>root: 数据集根目录路径</li></ul> <p><code>from timm.data import create_dataset</code></p> <h3 id="从torchvision中读取数据集"><a href="#从torchvision中读取数据集" class="header-anchor">#</a> 从TorchVision中读取数据集</h3> <p>通过在数据集名称前添加前缀<code>torch/</code>，可以通torchvision中下载数据。 通过设定<code>download=True</code>下载数据，设定<code>split='train'</code>选择下载的数据集类型</p> <div class="language- extra-class"><pre class="language-text"><code>ds = create_dataset('torch/cifar10', 'data', download=True, split='train')

ds, type(ds)
(Dataset CIFAR10
     Number of datapoints: 50000
     Root location: data
     Split: Train,
 torchvision.datasets.cifar.CIFAR10)
</code></pre></div><p>这样加载的是torchvision版本 因此没有reader属性。</p> <h3 id="从本地加载数据"><a href="#从本地加载数据" class="header-anchor">#</a> 从本地加载数据</h3> <blockquote><p>In addition to being able to load from ImageNet style folder hierarchies, create_dataset also lets us extract from one or more tar archives; we can use this to avoid having to untar the archive! As an example, we can try this out on the <a href="https://github.com/fastai/imagenette" target="_blank" rel="noopener noreferrer">Imagenette dataset<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></blockquote> <p>通过将<code>name=''</code>设置为空字符串，我们可以从本地读取数据，除了能够读取ImageNet 格式的文档数据， create_dataset还允许我们直接读取tar类型的文件，而不需要自己提前解压缩。</p> <p>在读取的时候，可以通过<code>transform=</code>传入所需要的transforms.</p> <p>首先下载Imagenette 数据集</p> <div class="language-shell extra-class"><pre class="language-shell"><code>run only once
<span class="token operator">!</span>wget https://s3.amazonaws.com/fast-ai-imageclas/imagenette2-320.tgz
<span class="token operator">!</span>gunzip imagenette2-320.tgz
</code></pre></div><p>解压tgz格式数据集，获得imagenette2-320.tar格式文件</p> <div class="language- extra-class"><pre class="language-text"><code>ds = create_dataset(name='', 
                    root='data/imagenette/imagenette2-320.tar', 
                    transform=create_transform(224))

image, label = ds[0]
image.shape

torch.Size([3, 224, 224])
</code></pre></div><h3 id="imagedataset-class"><a href="#imagedataset-class" class="header-anchor">#</a> ImageDataset class</h3> <p>上文我们已经看到<code>create_dataset</code>能够提供多种选择去处理不同类型的数据，但是很多时候我们可以自定义数据集的文档结构。</p> <p>这是使用的是<code>ImageDataset</code>其功能和 <code>[torchvision.datasets.ImageFolder](https://pytorch.org/vision/main/generated/torchvision.datasets.ImageFolder.html)</code>相似，同时提供了额外的功能</p> <p>ImageDataset可以作为<code>torchvision.datasets.ImageFolder</code>的替代。比如仍然使用imagenette2-320数据集，他的结构如下：</p> <div class="language-python extra-class"><pre class="language-python"><code>imagenette2<span class="token operator">-</span><span class="token number">320</span>
├── train
│   ├── n01440764
│   ├── n02102040
│   ├── n02979186
│   ├── n03000684
│   ├── n03028079
│   ├── n03394916
│   ├── n03417042
│   ├── n03425413
│   ├── n03445777
│   └── n03888257
└── val
    ├── n01440764
    ├── n02102040
    ├── n02979186
    ├── n03000684
    ├── n03028079
    ├── n03394916
    ├── n03417042
    ├── n03425413
    ├── n03445777
    └── n03888257
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> timm<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dataset <span class="token keyword">import</span> ImageDataset
imagenette_ds <span class="token operator">=</span> ImageDataset<span class="token punctuation">(</span><span class="token string">'data/imagenette/imagenette2-320/train'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>imagenette_ds<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>imagenette_ds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token number">9469</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span>PIL<span class="token punctuation">.</span>Image<span class="token punctuation">.</span>Image image mode<span class="token operator">=</span>RGB size<span class="token operator">=</span>426x320 at <span class="token number">0x173813290</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p>ImageDataset的flexibility在于他的索引和读取数据是一个<code>Reader</code>对象。</p> <div class="language-python extra-class"><pre class="language-python"><code>imagenette_ds<span class="token punctuation">.</span>reader

<span class="token operator">&lt;</span>timm<span class="token punctuation">.</span>data<span class="token punctuation">.</span>readers<span class="token punctuation">.</span>reader_image_folder<span class="token punctuation">.</span>ReaderImageFolder at <span class="token number">0x172ffb9e0</span><span class="token operator">&gt;</span>
</code></pre></div><blockquote><p>Here, we can see that the default reader is an instance of ReaderImageFolder. Readers also contain useful information such as the class lookup, which we can access as seen below.</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code>imagenette_ds<span class="token punctuation">.</span>reader<span class="token punctuation">.</span>class_to_idx

<span class="token punctuation">{</span><span class="token string">'n01440764'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 <span class="token string">'n02102040'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string">'n02979186'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">'n03000684'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
 <span class="token string">'n03028079'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
 <span class="token string">'n03394916'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
 <span class="token string">'n03417042'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
 <span class="token string">'n03425413'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
 <span class="token string">'n03445777'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
 <span class="token string">'n03888257'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">}</span>
</code></pre></div><p>可以看到这个reader已经帮我们将raw labels变成了数字，可以直接用于训练。</p> <h3 id="创建自定义的reader"><a href="#创建自定义的reader" class="header-anchor">#</a> 创建自定义的Reader</h3> <p>但是在实际情况中，数据集的格式往往与ImageNet的格式不一致，如：</p> <div class="language- extra-class"><pre class="language-text"><code>root/class_1/xx1.jpg
root/class_1/xx2.jpg
root/class_2/xx1.jpg
root/class_2/xx2.jpg
</code></pre></div><p>对于这种结构的数据集，<code>ImageDataset</code>不能够适用，因此我们需要自己去实现一个自定义的数据集去处理这个类型的数据。另一种方式则是创建一个自定义的reader与ImageDataset结合使用。</p> <blockquote><p>As an example, let’s consider the <a href="https://www.robots.ox.ac.uk/~vgg/data/pets/" target="_blank" rel="noopener noreferrer">Oxford pets dataset<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, where all images are located in a single folder, and the class name — the name of each breed in this case — is contained in the filename.</p></blockquote> <blockquote><p>In this case, as we are still loading images from a local file system, it is only a slight tweak to ReaderImageFolder. Let’s take a look at how that is implemented for inspiration.</p></blockquote> <p>在notebook中 可以通过??method查看函数的docstring</p> <div class="language-python extra-class"><pre class="language-python"><code>??timm<span class="token punctuation">.</span>data<span class="token punctuation">.</span>readers<span class="token punctuation">.</span>reader_image_folder<span class="token punctuation">.</span>ReaderImageFolder

Init signature<span class="token punctuation">:</span>
timm<span class="token punctuation">.</span>data<span class="token punctuation">.</span>readers<span class="token punctuation">.</span>reader_image_folder<span class="token punctuation">.</span>ReaderImageFolder<span class="token punctuation">(</span>
    root<span class="token punctuation">,</span>
    class_map<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
    input_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
Docstring<span class="token punctuation">:</span>      <span class="token operator">&lt;</span>no docstring<span class="token operator">&gt;</span>
Source<span class="token punctuation">:</span>        
<span class="token keyword">class</span> <span class="token class-name">ReaderImageFolder</span><span class="token punctuation">(</span>Reader<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
            self<span class="token punctuation">,</span>
            root<span class="token punctuation">,</span>
            class_map<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
            input_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>root <span class="token operator">=</span> root
        class_to_idx <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">if</span> class_map<span class="token punctuation">:</span>
            class_to_idx <span class="token operator">=</span> load_class_map<span class="token punctuation">(</span>class_map<span class="token punctuation">,</span> root<span class="token punctuation">)</span>
        find_types <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">if</span> input_key<span class="token punctuation">:</span>
            find_types <span class="token operator">=</span> input_key<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>relpath<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> self<span class="token punctuation">.</span>root<span class="token punctuation">)</span>
        <span class="token keyword">return</span> filename
File<span class="token punctuation">:</span>           <span class="token operator">/</span>opt<span class="token operator">/</span>anaconda3<span class="token operator">/</span>envs<span class="token operator">/</span>timm<span class="token operator">/</span>lib<span class="token operator">/</span>python3<span class="token punctuation">.</span><span class="token number">12</span><span class="token operator">/</span>site<span class="token operator">-</span>packages<span class="token operator">/</span>timm<span class="token operator">/</span>data<span class="token operator">/</span>readers<span class="token operator">/</span>reader_image_folder<span class="token punctuation">.</span>py
Type<span class="token punctuation">:</span>           <span class="token builtin">type</span>
Subclasses<span class="token punctuation">:</span>     
</code></pre></div><p>另一种方式则是使用inspect库直接获得source code</p> <div class="language- extra-class"><pre class="language-text"><code>import inspect
lines = inspect.getsource(timm.data.readers.reader_image_folder.ReaderImageFolder)
print(lines)

class ReaderImageFolder(Reader):

    def __init__(
            self,
            root,
            class_map='',
            input_key=None,
    ):
        super().__init__()

        self.root = root
        class_to_idx = None
        if class_map:
            class_to_idx = load_class_map(class_map, root)
        find_types = None
        if input_key:
            find_types = input_key.split(';')
        self.samples, self.class_to_idx = find_images_and_targets(
            root,
            class_to_idx=class_to_idx,
            types=find_types,
        )
        if len(self.samples) == 0:
            raise RuntimeError(
                f'Found 0 images in subfolders of {root}. '
...
        elif not absolute:
            filename = os.path.relpath(filename, self.root)
        return filename
</code></pre></div><p>通过源码我们可以知道，ReaderImageFolder主要完成以下几件事情：</p> <ul><li>creates a mapping for the classes</li> <li>implements __len__to return the number of samples</li> <li>implements _filename to return the filename of the sample, with options to determine whether it should be an absolute or relative path</li> <li>implements __getitem__ to return the sample and target.</li></ul> <p>现在我们知道我们应该去实现什么功能</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">from</span> timm<span class="token punctuation">.</span>data<span class="token punctuation">.</span>readers<span class="token punctuation">.</span>reader <span class="token keyword">import</span> Reader

<span class="token keyword">class</span> <span class="token class-name">ReaderImageName</span><span class="token punctuation">(</span>Reader<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> root<span class="token punctuation">,</span> class_to_idx<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>root <span class="token operator">=</span> Path<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>samples <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">&quot;*.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> class_to_idx<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>class_to_idx <span class="token operator">=</span> class_to_idx
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            classes <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>
                <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>__extract_label_from_path<span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> self<span class="token punctuation">.</span>samples<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                key<span class="token operator">=</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>class_to_idx <span class="token operator">=</span> <span class="token punctuation">{</span>c<span class="token punctuation">:</span> idx <span class="token keyword">for</span> idx<span class="token punctuation">,</span> c <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>classes<span class="token punctuation">)</span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">__extract_label_from_path</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">.</span>parts<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        path <span class="token operator">=</span> self<span class="token punctuation">.</span>samples<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        target <span class="token operator">=</span> self<span class="token punctuation">.</span>class_to_idx<span class="token punctuation">[</span>self<span class="token punctuation">.</span>__extract_label_from_path<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>samples<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_filename</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">,</span> basename<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> absolute<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        filename <span class="token operator">=</span> self<span class="token punctuation">.</span>samples<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> basename<span class="token punctuation">:</span>
            filename <span class="token operator">=</span> filename<span class="token punctuation">.</span>parts<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">elif</span> <span class="token keyword">not</span> absolute<span class="token punctuation">:</span>
            filename <span class="token operator">=</span> filename<span class="token punctuation">.</span>absolute<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> filename
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>data_path <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'data/oxford-iiit-pet/images'</span><span class="token punctuation">)</span>
ds <span class="token operator">=</span> ImageDataset<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>data_path<span class="token punctuation">)</span><span class="token punctuation">,</span> reader<span class="token operator">=</span>ReaderImageName<span class="token punctuation">(</span>data_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
ds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token punctuation">(</span><span class="token operator">&lt;</span>PIL<span class="token punctuation">.</span>Image<span class="token punctuation">.</span>Image image mode<span class="token operator">=</span>RGB size<span class="token operator">=</span>183x275<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>
</code></pre></div><p>目前来看 一切进展顺利，此外作为默认的reader我们可以查看类的mapping:</p> <div class="language-python extra-class"><pre class="language-python"><code>ds<span class="token punctuation">.</span>reader<span class="token punctuation">.</span>class_to_idx

<span class="token punctuation">{</span><span class="token string">'Abyssinian'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 <span class="token string">'american_bulldog'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string">'american_pit_bull_terrier'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">'basset_hound'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
 <span class="token string">'beagle'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
 <span class="token string">'Bengal'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
 <span class="token string">'Birman'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
 <span class="token string">'Bombay'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
 <span class="token string">'boxer'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
 <span class="token string">'British_Shorthair'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
 <span class="token string">'chihuahua'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
 <span class="token string">'Egyptian_Mau'</span><span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
 <span class="token string">'english_cocker_spaniel'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
 <span class="token string">'english_setter'</span><span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
 <span class="token string">'german_shorthaired'</span><span class="token punctuation">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
 <span class="token string">'great_pyrenees'</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
 <span class="token string">'havanese'</span><span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
 <span class="token string">'japanese_chin'</span><span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span>
 <span class="token string">'keeshond'</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
 <span class="token string">'leonberger'</span><span class="token punctuation">:</span> <span class="token number">19</span><span class="token punctuation">,</span>
 <span class="token string">'Maine_Coon'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
 <span class="token string">'miniature_pinscher'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
 <span class="token string">'newfoundland'</span><span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
 <span class="token string">'Persian'</span><span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
 <span class="token string">'pomeranian'</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token string">'Siamese'</span><span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
 <span class="token string">'Sphynx'</span><span class="token punctuation">:</span> <span class="token number">33</span><span class="token punctuation">,</span>
 <span class="token string">'staffordshire_bull_terrier'</span><span class="token punctuation">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
 <span class="token string">'wheaten_terrier'</span><span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
 <span class="token string">'yorkshire_terrier'</span><span class="token punctuation">:</span> <span class="token number">36</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="optimizers"><a href="#optimizers" class="header-anchor">#</a> Optimizers</h2> <p>timm提供了大量的optimizers，其中的一些在PyTorch中还有没有实现。</p> <ul><li>AdamP: described in this <a href="https://arxiv.org/abs/2006.08217" target="_blank" rel="noopener noreferrer">paper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>RMSPropTF: an implementation of <a href="https://www.cs.toronto.edu/~tijmen/csc321/slides/lecture_slides_lec6.pdf" target="_blank" rel="noopener noreferrer">RMSProp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> based on the original TensorFlow implementation, with other <a href="https://github.com/pytorch/pytorch/issues/23796" target="_blank" rel="noopener noreferrer">small tweaks discussed here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. In my experience, this often results in more stable training than the PyTorch version</li> <li>LAMB: a pure pytorch variant of <a href="https://nvidia.github.io/apex/optimizers.html#apex.optimizers.FusedLAMB" target="_blank" rel="noopener noreferrer">FusedLAMB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> optimizer from Apex, which is TPU compatible when using PyTorch XLA</li> <li>AdaBelief: described in this <a href="https://arxiv.org/abs/2010.07468" target="_blank" rel="noopener noreferrer">paper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Guidance on setting the hyperparameters is available <a href="https://github.com/juntang-zhuang/Adabelief-Optimizer#quick-guide" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>MADGRAD: described in this <a href="https://arxiv.org/abs/2101.11075" target="_blank" rel="noopener noreferrer">paper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>AdaHessian: an adaptive second order optimizer, described in this <a href="https://arxiv.org/abs/2006.00719" target="_blank" rel="noopener noreferrer">paper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>如果想要查看所有的optimizers:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> inspect
<span class="token keyword">import</span> timm<span class="token punctuation">.</span>optim

<span class="token punctuation">[</span>cls_name <span class="token keyword">for</span> cls_name<span class="token punctuation">,</span> cls_obj <span class="token keyword">in</span> inspect<span class="token punctuation">.</span>getmembers<span class="token punctuation">(</span>timm<span class="token punctuation">.</span>optim<span class="token punctuation">)</span> <span class="token keyword">if</span> inspect<span class="token punctuation">.</span>isclass<span class="token punctuation">(</span>cls_obj<span class="token punctuation">)</span> <span class="token keyword">if</span> cls_name <span class="token operator">!=</span><span class="token string">'Lookahead'</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span><span class="token string">'AdaBelief'</span><span class="token punctuation">,</span>
 <span class="token string">'Adafactor'</span><span class="token punctuation">,</span>
 <span class="token string">'Adahessian'</span><span class="token punctuation">,</span>
 <span class="token string">'AdamP'</span><span class="token punctuation">,</span>
 <span class="token string">'AdamW'</span><span class="token punctuation">,</span>
 <span class="token string">'Adan'</span><span class="token punctuation">,</span>
 <span class="token string">'Lamb'</span><span class="token punctuation">,</span>
 <span class="token string">'Lars'</span><span class="token punctuation">,</span>
 <span class="token string">'Lion'</span><span class="token punctuation">,</span>
 <span class="token string">'MADGRAD'</span><span class="token punctuation">,</span>
 <span class="token string">'Nadam'</span><span class="token punctuation">,</span>
 <span class="token string">'NvNovoGrad'</span><span class="token punctuation">,</span>
 <span class="token string">'RAdam'</span><span class="token punctuation">,</span>
 <span class="token string">'RMSpropTF'</span><span class="token punctuation">,</span>
 <span class="token string">'SGDP'</span><span class="token punctuation">]</span>
</code></pre></div><p>最简单的一个方式去创建optimizer是使用<code>create_optimizer_v2</code>这个工厂函数，</p> <ul><li>a model, or set of parameters</li> <li>the name of the optimizer</li> <li>any arguments to pass to the optimizer</li></ul> <blockquote><p>We can use this function to create any of the optimizer implementations included from timm, as well as popular optimizers from torch.optim and the <a href="https://nvidia.github.io/apex/optimizers.html" target="_blank" rel="noopener noreferrer">fused optimizers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> from <a href="https://nvidia.github.io/apex/index.html" target="_blank" rel="noopener noreferrer">Apex<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (if installed).</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> torch
model <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
    torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

optimizer <span class="token operator">=</span> timm<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>create_optimizer_v2<span class="token punctuation">(</span>model<span class="token punctuation">,</span> opt<span class="token operator">=</span><span class="token string">'sgd'</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span><span class="token punctuation">)</span>

SGD <span class="token punctuation">(</span>
Parameter Group <span class="token number">0</span>
    dampening<span class="token punctuation">:</span> <span class="token number">0</span>
    differentiable<span class="token punctuation">:</span> <span class="token boolean">False</span>
    foreach<span class="token punctuation">:</span> <span class="token boolean">None</span>
    fused<span class="token punctuation">:</span> <span class="token boolean">None</span>
    lr<span class="token punctuation">:</span> <span class="token number">0.01</span>
    maximize<span class="token punctuation">:</span> <span class="token boolean">False</span>
    momentum<span class="token punctuation">:</span> <span class="token number">0.8</span>
    nesterov<span class="token punctuation">:</span> <span class="token boolean">True</span>
    weight_decay<span class="token punctuation">:</span> <span class="token number">0.0</span>
<span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'torch.optim.sgd.SGD'</span><span class="token operator">&gt;</span>
</code></pre></div><p>这里我们可以看到timm并没有去实现sgd, 他实际上使用了torch.optim去创建， 让我们看一个timm自己实现的optimizer:</p> <div class="language-python extra-class"><pre class="language-python"><code>optimizer <span class="token operator">=</span> timm<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>create_optimizer_v2<span class="token punctuation">(</span>model<span class="token punctuation">,</span> opt<span class="token operator">=</span><span class="token string">'lamb'</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span><span class="token punctuation">)</span>

Lamb <span class="token punctuation">(</span>
Parameter Group <span class="token number">0</span>
    always_adapt<span class="token punctuation">:</span> <span class="token boolean">False</span>
    betas<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.999</span><span class="token punctuation">)</span>
    bias_correction<span class="token punctuation">:</span> <span class="token boolean">True</span>
    eps<span class="token punctuation">:</span> <span class="token number">1e-06</span>
    grad_averaging<span class="token punctuation">:</span> <span class="token boolean">True</span>
    lr<span class="token punctuation">:</span> <span class="token number">0.01</span>
    max_grad_norm<span class="token punctuation">:</span> <span class="token number">1.0</span>
    trust_clip<span class="token punctuation">:</span> <span class="token boolean">False</span>
    weight_decay<span class="token punctuation">:</span> <span class="token number">0.0</span>

Parameter Group <span class="token number">1</span>
    always_adapt<span class="token punctuation">:</span> <span class="token boolean">False</span>
    betas<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.999</span><span class="token punctuation">)</span>
    bias_correction<span class="token punctuation">:</span> <span class="token boolean">True</span>
    eps<span class="token punctuation">:</span> <span class="token number">1e-06</span>
    grad_averaging<span class="token punctuation">:</span> <span class="token boolean">True</span>
    lr<span class="token punctuation">:</span> <span class="token number">0.01</span>
    max_grad_norm<span class="token punctuation">:</span> <span class="token number">1.0</span>
    trust_clip<span class="token punctuation">:</span> <span class="token boolean">False</span>
    weight_decay<span class="token punctuation">:</span> <span class="token number">0.01</span>
<span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'timm.optim.lamb.Lamb'</span><span class="token operator">&gt;</span>
</code></pre></div><p>可以看到timm的Lamb实现已经被使用，并且weight decay被应用在paramter group 1.</p> <h3 id="自己创建optimizers"><a href="#自己创建optimizers" class="header-anchor">#</a> 自己创建optimizers</h3> <p>如果我们不想使用<code>create_optimizer_v2</code>， 那么这些optimizer可以以正常的方式去创建</p> <p><code>optimizer = timm.optim.RMSpropTF(model.parameters, lr=0.01)</code></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learning-blogs/pytorch-timm/" class="prev router-link-active">
        PyTorch Timm 安装
      </a></span> <span class="next"><a href="/learning-blogs/pytorch-lightning/">
        PyTorch Lightning 安装
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/learning-blogs/assets/js/app.023149a4.js" defer></script><script src="/learning-blogs/assets/js/2.4cc10ed0.js" defer></script><script src="/learning-blogs/assets/js/1.91ea3048.js" defer></script><script src="/learning-blogs/assets/js/11.a25d570d.js" defer></script>
  </body>
</html>
